<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="ru-RU">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="ru-RU">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="ru-RU">
<![endif]-->
<!--[if !(IE 6) & !(IE 7) & !(IE 8)]><!-->
<html lang="ru-RU">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Скрипт для защиты от прожорливых ботов, валящих сервер | Суета</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="wp-content/themes/twentyeleven/style.css" />
<link rel="pingback" href="xmlrpc.php.html" />
<!--[if lt IE 9]>
<script src="http://www.ktulhu.net/wp-content/themes/twentyeleven/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='index.html' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Суета &raquo; Лента" href="http://www.ktulhu.net/feed" />
<link rel="alternate" type="application/rss+xml" title="Суета &raquo; Лента комментариев" href="http://www.ktulhu.net/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Суета &raquo; Лента комментариев к &laquo;Скрипт для защиты от прожорливых ботов, валящих сервер&raquo;" href="http://www.ktulhu.net/skript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.ktulhu.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='http://www.ktulhu.net/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.ktulhu.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml.html" /> 
<link rel='prev' title='Сравнение эффективности анонсов на форумах' href='sravnenie-effektivnosti-anonsov-na-forumax.html' />
<link rel='next' title='WordPress плагин для сервиса сабмита социалок' href='wordpress-plagin-dlya-servisa-sabmita-socialok.html' />
<meta name="generator" content="WordPress 4.7.2" />
<link rel="canonical" href="skript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html" />
<link rel='shortlink' href='http://www.ktulhu.net/?p=11' />
<link rel="alternate" type="application/json+oembed" href="http://www.ktulhu.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.ktulhu.net%2Fskript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html" />
<link rel="alternate" type="text/xml+oembed" href="http://www.ktulhu.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.ktulhu.net%2Fskript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html&#038;format=xml" />
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		</head>

<body class="post-template-default single single-post postid-11 single-format-standard single-author singular two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="index.html" rel="home">Суета</a></span></h1>
				<h2 id="site-description">онлайновая и оффлайновая</h2>
			</hgroup>

			
								<form method="get" id="searchform" action="index.html">
		<label for="s" class="assistive-text">Поиск</label>
		<input type="text" class="field" name="s" id="s" placeholder="Поиск" />
		<input type="submit" class="submit" name="submit" id="searchsubmit" value="Поиск" />
	</form>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Главное меню</h3>
								<div class="skip-link"><a class="assistive-text" href="skript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html#content">Перейти к основному содержимому</a></div>
												<div class="menu-menyu-1-container"><ul id="menu-menyu-1" class="menu"><li id="menu-item-1007" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1007"><a href="https://tropnikov.com/">Домашняя страница</a></li>
<li id="menu-item-1005" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1005"><a href="index.html">Новости</a></li>
<li id="menu-item-1006" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1006"><a href="kontakty.html">Контакты</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					<nav id="nav-single">
						<h3 class="assistive-text">Навигация по записям</h3>
						<span class="nav-previous"><a href="sravnenie-effektivnosti-anonsov-na-forumax.html" rel="prev"><span class="meta-nav">&larr;</span> Предыдущая</a></span>
						<span class="nav-next"><a href="wordpress-plagin-dlya-servisa-sabmita-socialok.html" rel="next">Следующая <span class="meta-nav">&rarr;</span></a></span>
					</nav><!-- #nav-single -->

					
<article id="post-11" class="post-11 post type-post status-publish format-standard hentry category-skripty">
	<header class="entry-header">
		<h1 class="entry-title">Скрипт для защиты от прожорливых ботов, валящих сервер</h1>

				<div class="entry-meta">
			<span class="sep">Опубликовано </span><a href="skript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html" title="2:55 пп" rel="bookmark"><time class="entry-date" datetime="2008-01-18T14:55:30+00:00">18.01.2008</time></a><span class="by-author"> <span class="sep"> автором </span> <span class="author vcard"><a class="url fn n" href="author/admin/index.html" title="Посмотреть все записи автора admin" rel="author">admin</a></span></span>		</div><!-- .entry-meta -->
			</header><!-- .entry-header -->

	<div class="entry-content">
		<p>В последнее время почти каждая банда вебмастеров считает нужным сделать свой поисковик. Хороших программеров на все поисковики не хватает поэтому их поделия тупо валят сервера. Причем представляться они могут разнообразными юзерагентами, ходить с кучи адросов и даже юзать прокси. При ручном просмотре логов таких ботов можно заметить, но задача автоматизации их отлова в общем случае еще не решена. Обозначенная проблема актуальна для сайтовладельцев, что было озвученно в <a href="http://alexf.name/2008-01-18/zashhita-ot-lyogkogo-ddosa-ddos/">блоге Alexf </a>.</p>
<p>Можно предположить что такие боты будут есть только HTML документы, а не js/css/gif/… В тоже время браузер обычного юзера помимо самого документа продергивает css и картинки. Юзеры с отключенными картинками и яваскриптами пользы не приносят (ибо рекламу не видят) и ничего страшного если при назойливом обращении к серверу их тоже посчитают ботами.</p>
<p>Тоесть для отлова свежих ботов нужен скрипт который читает конец лога (например 100 секунд) ищет подсети с которых взяли много (например больше 5) html документов и мало (непример меньше 10%) css/картинок. Такие подсети режутся фаирволом до амнистии (например на 10 минут). Если после амнистии подсеть опять валит сервер, то она снова уходит в бан.</p>
<p>На своих FreeBSD серверах я использую следующий скрипт:</p>
<p><span id="more-11"></span><a href="http://ktulhu.net/work/antirobot.php.txt">скрипт</a></p>
<p>После пуска по крону лог скрипта наполняется  приятными сообщениями о забаненных ботах:</p>
<pre>Fri, 18 Jan 2008 14:48:01 -0600 6       0       64.34.145.0/24  SBIder/SBIder-0.8.2-dev (http://www.sitesell.com/sbider.html)
Fri, 18 Jan 2008 14:49:00 -0600 20      0       77.75.72.0/24   SeznamBot/2.0 (+http://fulltext.seznam.cz/)
Fri, 18 Jan 2008 14:50:00 -0600 6       0       220.181.19.0/24 Sogou web spider/3.0(+http://www.sogou.com/docs/help/webmasters.htm#07)
Fri, 18 Jan 2008 14:54:00 -0600 6       0       208.36.144.0/24 Mozilla/5.0 (Twiceler-0.9 http://www.cuill.com/twiceler/robot.html)
Fri, 18 Jan 2008 14:55:01 -0600 6       0       61.247.217.0/24 Yeti/0.01 (nhn/1noon, yetibot@naver.com, check robots.txt daily and follow it)
Fri, 18 Jan 2008 14:57:00 -0600 6       0       193.252.149.0/24        Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.8.1) VoilaBot BETA 1.2 (http://www.voila.com/)</pre>
			</div><!-- .entry-content -->

	<footer class="entry-meta">
		Запись опубликована автором <a href="author/admin/index.html">admin</a> в рубрике <a href="category/skripty.html" rel="category tag">скрипты</a>. Добавьте в закладки <a href="skript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html" title="Постоянная ссылка: Скрипт для защиты от прожорливых ботов, валящих сервер" rel="bookmark">постоянную ссылку</a>.		
			</footer><!-- .entry-meta -->
</article><!-- #post-11 -->

						<div id="comments">
	
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="skript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html#respond" style="display:none;">Отменить ответ</a></small></h3><p class="must-log-in">Для отправки комментария вам необходимо <a href="http://www.ktulhu.net/wp-login.php?redirect_to=http%3A%2F%2Fwww.ktulhu.net%2Fskript-dlya-zashhity-ot-prozhorlivyx-botov-valyashhix-server.html">авторизоваться</a>.</p>	</div><!-- #respond -->
	
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			
<div id="supplementary" class="one">
		<div id="first" class="widget-area" role="complementary">
		<aside id="text-7" class="widget widget_text">			<div class="textwidget"><!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://seomon.com/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 8]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="https://seomon.com/piwik/piwik.php?idsite=8" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code --></div>
		</aside>	</div><!-- #first .widget-area -->
	
	
	</div><!-- #supplementary -->
			<div id="site-generator">
								<a href="https://ru.wordpress.org/" title="Современная персональная платформа для публикаций">Сайт работает на WordPress</a>
			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<div id="lessbuttons_holder"></div><script async src="https://lessbuttons.com/script.js?position=left&onmobile=bottom&facebook=1&twitter=1&googleplus=1&linkedin=1&pinterest=1&reddit=1&vkontakte=1&odnoklassniki=1&email=1&zindex=100501"></script><script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/comment-reply.min.js?ver=4.7.2'></script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.51.0-2014.06.20'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"recaptcha":{"messages":{"empty":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435, \u0447\u0442\u043e \u0412\u044b - \u043d\u0435 \u0440\u043e\u0431\u043e\u0442."}}};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.6.1'></script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/wp-embed.min.js?ver=4.7.2'></script>

</body>
</html>