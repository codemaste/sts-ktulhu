<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="ru-RU">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="ru-RU">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="ru-RU">
<![endif]-->
<!--[if !(IE 6) & !(IE 7) & !(IE 8)]><!-->
<html lang="ru-RU">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Работа с TRIM у SSD диска в Ubuntu | Суета</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="wp-content/themes/twentyeleven/style.css" />
<link rel="pingback" href="xmlrpc.php.html" />
<!--[if lt IE 9]>
<script src="http://www.ktulhu.net/wp-content/themes/twentyeleven/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='index.html' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Суета &raquo; Лента" href="http://www.ktulhu.net/feed" />
<link rel="alternate" type="application/rss+xml" title="Суета &raquo; Лента комментариев" href="http://www.ktulhu.net/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Суета &raquo; Лента комментариев к &laquo;Работа с TRIM у SSD диска в Ubuntu&raquo;" href="http://www.ktulhu.net/rabota-s-trim-u-ssd-diska-v-ubuntu.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.ktulhu.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='http://www.ktulhu.net/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.ktulhu.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml.html" /> 
<link rel='prev' title='Самые популярные Web-сервера' href='samye-populyarnye-web-servera.html' />
<link rel='next' title='Производительность SSD Intel X25-V в Linux Ubuntu 10.10' href='proizvoditelnost-ssd-intel-x25-v-v-linux-ubuntu-10-10.html' />
<meta name="generator" content="WordPress 4.7.2" />
<link rel="canonical" href="rabota-s-trim-u-ssd-diska-v-ubuntu.html" />
<link rel='shortlink' href='http://www.ktulhu.net/?p=275' />
<link rel="alternate" type="application/json+oembed" href="http://www.ktulhu.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.ktulhu.net%2Frabota-s-trim-u-ssd-diska-v-ubuntu.html" />
<link rel="alternate" type="text/xml+oembed" href="http://www.ktulhu.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.ktulhu.net%2Frabota-s-trim-u-ssd-diska-v-ubuntu.html&#038;format=xml" />
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		</head>

<body class="post-template-default single single-post postid-275 single-format-standard single-author singular two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="index.html" rel="home">Суета</a></span></h1>
				<h2 id="site-description">онлайновая и оффлайновая</h2>
			</hgroup>

			
								<form method="get" id="searchform" action="index.html">
		<label for="s" class="assistive-text">Поиск</label>
		<input type="text" class="field" name="s" id="s" placeholder="Поиск" />
		<input type="submit" class="submit" name="submit" id="searchsubmit" value="Поиск" />
	</form>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Главное меню</h3>
								<div class="skip-link"><a class="assistive-text" href="rabota-s-trim-u-ssd-diska-v-ubuntu.html#content">Перейти к основному содержимому</a></div>
												<div class="menu-menyu-1-container"><ul id="menu-menyu-1" class="menu"><li id="menu-item-1007" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1007"><a href="https://tropnikov.com/">Домашняя страница</a></li>
<li id="menu-item-1005" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1005"><a href="index.html">Новости</a></li>
<li id="menu-item-1006" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1006"><a href="kontakty.html">Контакты</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					<nav id="nav-single">
						<h3 class="assistive-text">Навигация по записям</h3>
						<span class="nav-previous"><a href="samye-populyarnye-web-servera.html" rel="prev"><span class="meta-nav">&larr;</span> Предыдущая</a></span>
						<span class="nav-next"><a href="proizvoditelnost-ssd-intel-x25-v-v-linux-ubuntu-10-10.html" rel="next">Следующая <span class="meta-nav">&rarr;</span></a></span>
					</nav><!-- #nav-single -->

					
<article id="post-275" class="post-275 post type-post status-publish format-standard hentry category-offlajn tag-3g tag-6910p tag-bluetooth tag-firmware tag-fstab tag-hdparm tag-nc2400 tag-ssd tag-trim tag-ubuntu tag-wi-fi tag-disk">
	<header class="entry-header">
		<h1 class="entry-title">Работа с TRIM у SSD диска в Ubuntu</h1>

				<div class="entry-meta">
			<span class="sep">Опубликовано </span><a href="rabota-s-trim-u-ssd-diska-v-ubuntu.html" title="7:11 пп" rel="bookmark"><time class="entry-date" datetime="2011-03-08T19:11:32+00:00">08.03.2011</time></a><span class="by-author"> <span class="sep"> автором </span> <span class="author vcard"><a class="url fn n" href="author/admin/index.html" title="Посмотреть все записи автора admin" rel="author">admin</a></span></span>		</div><!-- .entry-meta -->
			</header><!-- .entry-header -->

	<div class="entry-content">
		<p>В рамках целевой программы апгрейда вычислительной техники, вместо верно прослужившено hp-compaq nc2400, в славной компании <a href="http://noteland.ru/">Ноутленд</a> был недорого приобретен hp-compaq 6910p. Необходимость апгрейда была обусловлена невысокой скоростью работы процессора U2500 установленного в nc2400. В качестве альтернативы апгрейда процессора рассматривался вариант замены жесткого диска на SSD накопитель. Но nc2400 имеет интерфейс жесткого диска IDE, а большинство SSD накопителей имеют интерфейс SATA. По совокупности вышеозначенных обстоятельств было решено произвести двойной апгрейд &#8212; ноутбука и сразу жесткого диска в нем.<br />
<span id="more-275"></span><br />
В качестве SSD диска был выбран дешевый и сердитый вариант Intel X25-V объемом 40Gb. Проверенная марка производителя удачно сочетается с невысокой <a href="http://www.price-omsk.ru/Intel_ssd/">ценой этой модели диска в магазинах</a>. Относительно небольшой объем накопителя не является проблемой ибо основные объемные данные хранятся на внешних сетевых дисках и постоянно иметь их внутри ноутбука не имеет особого смысла.</p>
<p>Firmware диска была обновлена до <a href="http://downloadcenter.intel.com/Detail_Desc.aspx?agr=Y&#038;DwnldID=18363">последней версии</a>. На диск была установлена операционная система Ubuntu версии 10.10. Система без дополнительных усилий, сразу после установки, начала работать со всеми устройствами ноутбука Wi-Fi, 3G, Bluetooth&#8230;</p>
<p>SSD Диск Intel X25-V и операционная система Ubuntu 10.10 имеют поддержку <a href="http://ru.wikipedia.org/wiki/TRIM_%28%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D0%B0_SSD%29">команды TRIM</a>:</p>
<blockquote><p>Команда TRIM была введена вскоре после появления SSD, чтобы сделать их конкурентоспособной альтернативой традиционным HDD в персональных компьютерах. Из-за того, что на внутреннем уровне реализация операций в SSD существенно отличаются от тех же операций в традиционных механических жёстких дисках, обычные методы ОС таких операций, как удаление файлов и форматирование диска (не обращаясь непосредственно к затрагиваемым секторам/страницам на накопителе), приводит к прогрессирующему ухудшению производительности операций записи на SSD. Применение TRIM позволяет устройству SSD уменьшить влияние сборки мусора, которая в противном случае в дальнейшем выразится падением производительности операций записи в затронутые секторы.</p></blockquote>
<p>Остается лишь задействовать поддержку этой технологии во благо SSD накопителя.</p>
<h2>Проверить работает ли TRIM</h2>
<p>Можно с помощью следующей последовательности команд исполняемых в консоли:</p>
<p>1. создаем временный файл заполненный случайными данными:</p>
<pre>cd /</pre>
<pre>sudo dd if=/dev/urandom of=tmpfile count=10 bs=512k oflag=direct</pre>
<p>2. находим номер сектора диска содержащего данные этого файла (нам нужно любое число из колонки begin_LBA):</p>
<pre>sudo hdparm --fibmap tmpfile</pre>
<p>3. проверяем содержимое этого сектора:</p>
<pre>sudo hdparm --read-sector 17179648 /dev/sda</pre>
<p>(вместо 17179648 подставьте номер сектора показанный командой из п.2 и вместо /dev/sda устройство которым обозначен SSD диск)<br />
будет показан набор случайных данных похожий на:</p>
<blockquote><p>
&#8230;<br />
adb1 0d7a e027 042e 84ad 3231 2f6c 85f1<br />
58ee feb6 cac0 d403 5df0 46db 2cfe 531c<br />
3cbd 5a21 e0b6 9b57 799a 7ac8 dd15 3883
</p></blockquote>
<p>4. удаляем файл:</p>
<pre>sudo rm tmpfile</pre>
<pre>sudo sync</pre>
<p>5. проверяем содержимое файла еще раз:</p>
<pre>sudo hdparm --read-sector 17179648 /dev/sda</pre>
<p>при включенной поддержке TRIM вывод будет содержать нули:</p>
<blockquote><p>
&#8230;<br />
0000 0000 0000 0000 0000 0000 0000 0000<br />
0000 0000 0000 0000 0000 0000 0000 0000<br />
0000 0000 0000 0000 0000 0000 0000 0000
</p></blockquote>
<p>если вывод содержит не нули, а данные из п. 3, то поддержка TRIM не осуществляется и нужно:</p>
<h2>Включить поддержку TRIM</h2>
<p>Для включения поддержки TRIM нужно открыть для редактирования файл /etc/fstab например так:</p>
<pre>sudo mc -e /etc/fstab</pre>
<p>и заменить:</p>
<blockquote><p>
UUID=b49c6a96-ee65-4c12-9aca-66f5ea927aab /               ext4     errors=remount-ro 0       1
</p></blockquote>
<p>на:</p>
<blockquote><p>
UUID=b49c6a96-ee65-4c12-9aca-66f5ea927aab /               ext4     discard,noatime,nodiratime,errors=remount-ro 0       1
</p></blockquote>
<p>(UUID=&#8230; менять не нужно, он будет другим у вашего диска)<br />
<strong>discard</strong> &#8212; включает поддержку TRIM.<br />
<strong>noatime,nodiratime</strong> &#8212; отключает запись времени доступа к файлу, что полезно для SSD диска.</p>
<p>После редактирования /etc/fstab нужно перезагрузить систему и повторить тестирование поддержки TRIM как было описано ранее.</p>
			</div><!-- .entry-content -->

	<footer class="entry-meta">
		Запись опубликована автором <a href="author/admin/index.html">admin</a> в рубрике <a href="category/offlajn/index.html" rel="category tag">оффлайн</a> с метками <a href="tag/3g.html" rel="tag">3G</a>, <a href="tag/6910p.html" rel="tag">6910p</a>, <a href="tag/bluetooth.html" rel="tag">Bluetooth</a>, <a href="tag/firmware.html" rel="tag">Firmware</a>, <a href="tag/fstab.html" rel="tag">fstab</a>, <a href="tag/hdparm.html" rel="tag">hdparm</a>, <a href="tag/nc2400.html" rel="tag">nc2400</a>, <a href="tag/ssd.html" rel="tag">ssd</a>, <a href="tag/trim.html" rel="tag">trim</a>, <a href="tag/ubuntu.html" rel="tag">Ubuntu</a>, <a href="tag/wi-fi.html" rel="tag">Wi-Fi</a>, <a href="tag/disk.html" rel="tag">диск</a>. Добавьте в закладки <a href="rabota-s-trim-u-ssd-diska-v-ubuntu.html" title="Постоянная ссылка: Работа с TRIM у SSD диска в Ubuntu" rel="bookmark">постоянную ссылку</a>.		
			</footer><!-- .entry-meta -->
</article><!-- #post-275 -->

						<div id="comments">
	
	
			<h2 id="comments-title">
			<span>Работа с TRIM у SSD диска в Ubuntu</span>: 1 комментарий		</h2>

		
		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-133">
		<article id="comment-133" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='http://2.gravatar.com/avatar/5456b43b1de885b5f87bfb728e29c5d6?s=68&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5456b43b1de885b5f87bfb728e29c5d6?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Александр</span> <span class="says">говорит</span> <a href="rabota-s-trim-u-ssd-diska-v-ubuntu.html#comment-133"><time datetime="2012-03-16T11:06:52+00:00">16.03.2012 в 11:06 дп</time></a>:
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Спасибо, включил trim.</p>
</div>

			<div class="reply">
				<a rel="nofollow" class="comment-reply-login" href="http://www.ktulhu.net/wp-login.php?redirect_to=http%3A%2F%2Fwww.ktulhu.net%2Frabota-s-trim-u-ssd-diska-v-ubuntu.html">Войдите, чтобы ответить</a>			</div><!-- .reply -->
		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
		</ol>

		
		
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="rabota-s-trim-u-ssd-diska-v-ubuntu.html#respond" style="display:none;">Отменить ответ</a></small></h3><p class="must-log-in">Для отправки комментария вам необходимо <a href="http://www.ktulhu.net/wp-login.php?redirect_to=http%3A%2F%2Fwww.ktulhu.net%2Frabota-s-trim-u-ssd-diska-v-ubuntu.html">авторизоваться</a>.</p>	</div><!-- #respond -->
	
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			
<div id="supplementary" class="one">
		<div id="first" class="widget-area" role="complementary">
		<aside id="text-7" class="widget widget_text">			<div class="textwidget"><!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://seomon.com/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 8]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="https://seomon.com/piwik/piwik.php?idsite=8" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code --></div>
		</aside>	</div><!-- #first .widget-area -->
	
	
	</div><!-- #supplementary -->
			<div id="site-generator">
								<a href="https://ru.wordpress.org/" title="Современная персональная платформа для публикаций">Сайт работает на WordPress</a>
			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<div id="lessbuttons_holder"></div><script async src="https://lessbuttons.com/script.js?position=left&onmobile=bottom&facebook=1&twitter=1&googleplus=1&linkedin=1&pinterest=1&reddit=1&vkontakte=1&odnoklassniki=1&email=1&zindex=100501"></script><script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/comment-reply.min.js?ver=4.7.2'></script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.51.0-2014.06.20'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"recaptcha":{"messages":{"empty":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435, \u0447\u0442\u043e \u0412\u044b - \u043d\u0435 \u0440\u043e\u0431\u043e\u0442."}}};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.6.1'></script>
<script type='text/javascript' src='http://www.ktulhu.net/wp-includes/js/wp-embed.min.js?ver=4.7.2'></script>

</body>
</html>